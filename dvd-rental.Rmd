---
title: "DVD Rental Data Analysis"
author: "Ayan Dey"
date: "2024-01-01"
output: html_document
---
**It is recommended, Before watching this document, Go through readme file for depth understanding** [click here to open README ](https://github.com/ayandey1359/dvd-rental-da/blob/main/README.md)  

## My Work Flow  
There are many business problems, and I'll solve them as stated below :\
**A**\
**loop** {\
step1: identify a single problem\
step2: EDA ( by **R** and **SQL**)\
step3: do Analyse\
step4: solve the problem\
step5: dashboard ( by Apache Superset) : for each problem I will create separate dashboard\
}  
After the **loop** process\
**B**\
do solve some business question by SQL | pgAdmin4 [github link]\
**C**\
Generate a Final Interactive Dashboard by Apache Superset\

## Let's Start

```{r}
# importing libraries
library(odbc)
library(DBI)
library(tidyverse)
library(visdat)
```

```{r,echo=FALSE}
# building connection with database
con <- dbConnect(odbc::odbc(),
                 driver = "PostgreSQL Unicode",
                 server = "localhost",
                 port = 5432, 
                 database = "codeone",
                 uid = "postgres",
                 pwd = "13599")
```
```{r ,eval=FALSE}
# building connection with database
con <- dbConnect(odbc::odbc(),
                 driver = "PostgreSQL Unicode",
                 server = "localhost",
                 port = 5432, 
                 database = "my_db",
                 uid = "**********",
                 pwd = "*********")
```

## 1st business problem

*Customer Retention and Satisfaction:*\
- What strategies can be implemented to enhance customer satisfaction and encourage repeat rentals?\
\> To solve this problem i need to retrieve customer,rental,inventory,and payment,film tables\
let see the ERD in LibreOffice Base\
![ERD](/home/ayan/project/dvd-rantal/images/p1_base_screen.jpg)

**The rental_id is a unique variable:** A film can stored in multiple DVD, a customer can take rent\
multiple DVD,But the rental_id is a id which only generated by each rental transaction .\
```{r}
query <- "SELECT rental.rental_id,customer.customer_id, category.name,film.length,  film.rental_duration, film.rental_rate, payment.amount, film.rating, film.replacement_cost, customer.active FROM public.film_category film_category, public.film film, public.category category, public.inventory inventory, public.payment payment, public.customer customer, public.rental rental WHERE film_category.film_id = film.film_id AND film_category.category_id = category.category_id AND inventory.film_id = film.film_id AND payment.customer_id = customer.customer_id AND payment.rental_id = rental.rental_id AND rental.customer_id = customer.customer_id AND rental.inventory_id = inventory.inventory_id"
result1 <- dbGetQuery(con, query)
head(result1)
```

```{r}
# View(result1)
```

**Focused on Customer Retention and Satisfaction**\

```{r}
# overview the data by heat map to identify the missing values
vis_dat(result1)
```
```{r}
# let focused on the missing values by heat map
vis_miss(result1)
```
- Missing Data Conclusion: This data don't have missing values  
**duplicates**
```{r}
# Total number of rows
nrow(result1)
```
```{r}
# Number of rows have duplicate values
nrow(result1[duplicated(result1$rental_id), ])
```
```{r}
# Removing duplicated values
result1 <- result1[!duplicated(result1$rental_id), ]
```
```{r}
# Number of rows of cleaned extracted data  
nrow(result1)
# View(result1)
```
At this point the current problem's data is cleaned with no missing values at the primary column\
and no duplicate values are there  
## Data Manipulation  
```{r}
# Lets see the Data-Type
glimpse(result1)
```
```{r}
# rental_id column must be a character data type
result1$rental_id <- as.character(result1$rental_id)
class(result1$rental_id)
```

```{r}
# customer_id column must be a character data type
result1$customer_id <- as.character(result1$customer_id)
class(result1$customer_id)
```
```{r}
# Active status must be a logical 
# But I keep it as numeric, it may help in later process
```

```{r}
# let's see data type 
str(result1)
```
```{r}
# observe rating column
result1 %>% drop_na(rating) %>% group_by(rating) %>% summarise(frequency=n())
```
```{r}
# rating column must be a factor data type
result1$rating <- as.factor(result1$rating)
class(result1$rating)
```
### Mathematical Operations
```{r}
# Data Statistics 
summary(result1)
```
deep dive into: result$length
```{r warning=FALSE}
# observe outliers in length column 
# Create a box plot
ggplot(result1) +
  geom_boxplot(mapping =aes(y = result1$length),fill = "lightblue", color = "darkblue", alpha =     0.7)+
  ggtitle("Length of Films") +
   ylab("Length")+
    theme_minimal()
```
```{r warning=FALSE}
# observe the distribution of data in length column 
ggplot(result1) +
  geom_histogram(mapping=aes(x=result1$length),binwidth = 10, fill = "blue", color = "black", alpha = 0.7) + 
    geom_vline(xintercept = median(result1$length), linetype = "dashed", color = "red", size = 1.5)+
    geom_vline(xintercept = mean(result1$length), linetype = "dashed", color = "yellow", size = 1.5) +
  ggtitle("Distribution of data 'length'") +
  xlab("Values") +
  ylab("Frequency") +
  theme_minimal()

```
```
# conclusion: This data distributed uniformly ('length' column) \In the length column ( film length/ Median :113.0, Mean   :115.4) there are few films\ are shorter,most of fils are likly same length,\
so this film length not much affected the customer Retention and Satisfaction.\
```
deep dive into: result$rental_duration
```{r}
summary(result1$rental_duration)
```

```{r}
# observe outliers in rental_duration column 
# Create a box plot
ggplot(result1) +
  geom_boxplot(mapping =aes(y = rental_duration),fill = "lightblue", color = "darkblue", alpha =     0.7)+
  ggtitle("rental_duration of Films") +
   ylab("rental_duration")+
    theme_minimal()
```
```{r}
summary(result1$rental_duration)
```

```{r}
# observe the distribution of data in rental_duration column 
ggplot(result1) +
  geom_histogram(mapping=aes(x=rental_duration),binwidth = 1, fill = "blue", color = "black", alpha = 0.7) + 
    geom_vline(xintercept = median(result1$rental_duration), linetype = "dashed", color = "red", size = 1.5)+
    geom_vline(xintercept = mean(result1$rental_duration), linetype = "dashed", color = "yellow", size = 1.5) +
  ggtitle("Distribution of data 'rental_duration'") +
  xlab("Values") +
  ylab("Frequency") +
  theme_minimal()
```
```
The Average rental duration of each DVD is 5 days, taking brandwidth= 1 day\
this data is uniformly distributed
```
deep dive into: result$rental_rate
```{r}
#
```


# **This Project is 'Under Construction'**  





```{r}
dbDisconnect(con)
```
